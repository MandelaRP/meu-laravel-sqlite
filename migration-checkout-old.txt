<?php

declare(strict_types = 1);

use Illuminate\Database\Migrations\Migration;
use Illuminate\Database\Schema\Blueprint;
use Illuminate\Support\Facades\Schema;

return new class () extends Migration
{
    /**
     * Run the migrations.
     */
    public function up(): void
    {
        Schema::create('checkouts', function (Blueprint $table): void {
            $table->uuid('id')->primary();
            $table->foreignUuid('product_id')->constrained('products');
            $table->foreignUuid('order_bump_id')->nullable()->constrained('products')->nullOnDelete();
            $table->string('checkout_template')->default('default');
            $table->enum('layout', ['single', 'two-column'])->default('single');
            $table->string('banner')->nullable();
            $table->boolean('countdown_enabled')->default(false);
            $table->string('countdown_icon')->nullable();
            $table->integer('countdown_duration')->nullable(); // duração em segundos
            $table->string('countdown_bg_color')->default('#dc2626'); // vermelho por padrão
            $table->string('countdown_text_color')->default('#ffffff'); // branco por padrão
            $table->string('countdown_message')->nullable();
            $table->timestamp('countdown_start_time')->nullable();
            $table->enum('countdown_icon_type', ['icon', 'emoji'])->default('icon');
            $table->boolean('countdown_expired')->default(false);
            $table->boolean('dark_mode')->default(false);
            $table->string('button_primary_color')->default('#10b981')->comment('Cor primária do botão (gradiente from)');
            $table->string('button_secondary_color')->default('#059669')->comment('Cor secundária do botão (gradiente to)');
            $table->string('button_hover_primary_color')->default('#059669')->comment('Cor primária do hover (gradiente from)');
            $table->string('button_hover_secondary_color')->default('#047857')->comment('Cor secundária do hover (gradiente to)');
            // Configuração dos campos do formulário
            $table->json('form_fields_config')->nullable()->comment('Configuração dos campos do formulário de checkout');

            // Campos individuais para facilitar consultas
            $table->boolean('require_name')->default(true)->comment('Exigir nome completo');
            $table->boolean('require_email')->default(true)->comment('Exigir email');
            $table->boolean('require_phone')->default(false)->comment('Exigir telefone');
            $table->boolean('require_cpf_cnpj')->default(false)->comment('Exigir CPF/CNPJ');
            $table->boolean('require_address')->default(false)->comment('Exigir endereço completo');
            $table->boolean('require_cep')->default(false)->comment('Exigir CEP');
            $table->boolean('require_city')->default(false)->comment('Exigir cidade');
            $table->boolean('require_state')->default(false)->comment('Exigir estado');
            $table->boolean('require_neighborhood')->default(false)->comment('Exigir bairro');
            $table->boolean('require_number')->default(false)->comment('Exigir número do endereço');
            $table->boolean('require_complement')->default(false)->comment('Exigir complemento');
            $table->string('background_color')->default('#f8fafc')->comment('Cor de fundo do checkout');
            // Cores dos steps
            $table->string('step_active_color')->default('#3b82f6')->comment('Cor do step ativo');
            $table->string('step_completed_color')->default('#10b981')->comment('Cor do step completado');
            $table->string('step_inactive_color')->default('#9ca3af')->comment('Cor do step inativo');
            $table->string('step_text_color')->default('#ffffff')->comment('Cor do texto dos steps');

            // Cores dos ícones de pagamento
            $table->string('payment_icon_primary_color')->default('#3b82f6')->comment('Cor primária dos ícones de pagamento');
            $table->string('payment_icon_secondary_color')->default('#1d4ed8')->comment('Cor secundária dos ícones de pagamento');
            $table->string('payment_icon_background_color')->default('#eff6ff')->comment('Cor de fundo dos ícones de pagamento');
            // Configurações dos métodos de pagamento
            $table->json('enabled_payment_methods')->nullable()->comment('Métodos de pagamento habilitados');

            // Cores personalizadas para cada método de pagamento
            $table->string('pix_icon_background_color')->default('#10b981')->comment('Cor de fundo do ícone PIX');
            $table->string('credit_card_icon_background_color')->default('#3b82f6')->comment('Cor de fundo do ícone Cartão de Crédito');
            $table->string('boleto_icon_background_color')->default('#f97316')->comment('Cor de fundo do ícone Boleto');
            $table->string('pix_check_icon_color')->default('#ffffff')->comment('Cor do ícone de check do PIX');
            $table->string('credit_card_check_icon_color')->default('#ffffff')->comment('Cor do ícone de check do Cartão de Crédito');
            $table->string('boleto_check_icon_color')->default('#ffffff')->comment('Cor do ícone de check do Boleto');
            $table->renameColumn('pix_check_icon_color', 'pix_check_icon_background_color');
            $table->renameColumn('credit_card_check_icon_color', 'credit_card_check_icon_background_color');
            $table->renameColumn('boleto_check_icon_color', 'boleto_check_icon_background_color');
            $table->timestamps();
        });
    }

    /**
     * Reverse the migrations.
     */
    public function down(): void
    {
        Schema::dropIfExists('checkouts');
    }
};
