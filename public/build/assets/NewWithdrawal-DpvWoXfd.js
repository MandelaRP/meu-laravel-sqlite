import{a as O,b as L,c as X,d as K,_ as U}from"./DialogTitle.vue_vue_type_script_setup_true_lang-CMVN-k-g.js";import{_ as se,a as le}from"./MoneyInput-BKjo1ri7.js";import{_ as H}from"./DialogFooter.vue_vue_type_script_setup_true_lang-Y11NQ4Uk.js";import{_ as re}from"./DialogTrigger.vue_vue_type_script_setup_true_lang-D0XSB0NE.js";import{_ as D}from"./Button.vue_vue_type_script_setup_true_lang-Bu1_OuLZ.js";import{_ as J}from"./Input.vue_vue_type_script_setup_true_lang-Zo94wQZG.js";import{_ as y}from"./Label.vue_vue_type_script_setup_true_lang-Y6gPyrr0.js";import{_ as ne,a as ie,b as de,c as ue,d as A}from"./SelectValue.vue_vue_type_script_setup_true_lang-TPDm6Qj2.js";import{C as me,r as R,k as M,c as q,o as h,a as o,b as s,u as a,I as fe,f as n,d,e as E,t as g,h as z,s as ce,W as pe}from"./app-S3kx2b0d.js";import{u as xe}from"./use-toast-DniFefJe.js";import{P as ve}from"./plus-D_WhIUaA.js";import{C as T}from"./circle-alert-V_6AzMZE.js";import{C as Z}from"./check-B_oeUEI1.js";import{L as ye}from"./loader-circle-BH5IDTPz.js";import"./index-BGfks83y.js";import"./floating-ui.vue-Bsqwf4g4.js";import"./utils-CytzSlOG.js";import"./x-Dj8XHr1q.js";import"./createLucideIcon-B4R1MoSR.js";import"./Primitive-odI4fKTA.js";import"./index-BszNJtDQ.js";import"./VisuallyHidden-BAG-HCFC.js";import"./Collection--76CoLyc.js";import"./useForwardExpose-BFkC9Kdc.js";import"./useId-xuC_jKGz.js";import"./handleAndDispatchCustomEvent-ChOKVcqp.js";import"./utils-Bd7HeyaL.js";import"./ohash.D__AXeF1-DHF4M4F_.js";import"./nullish-CHIgUVhi.js";import"./useFormControl-ZbpTWXBx.js";const ge={class:"space-y-6"},_e={class:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4"},be={class:"text-2xl font-bold text-green-600 dark:text-green-400"},ke={class:"space-y-2"},we={key:0,class:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1"},he={key:1,class:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1"},Fe={key:2,class:"text-xs text-red-600 dark:text-red-400 flex items-center gap-1"},Ve={key:0,class:"bg-blue-50 dark:bg-blue-900/20 rounded-xl p-4 space-y-3 border border-blue-200 dark:border-blue-800"},Ne={class:"flex justify-between items-center"},Pe={class:"text-sm font-semibold"},Ce={class:"flex justify-between items-center"},$e={class:"text-sm font-semibold text-red-600 dark:text-red-400"},qe={class:"flex justify-between items-center pt-2 border-t border-blue-200 dark:border-blue-800"},Se={class:"text-lg font-bold text-green-600 dark:text-green-400"},Ae={class:"space-y-3"},Ee={class:"grid grid-cols-2 gap-3"},We={class:"space-y-2"},Be={class:"space-y-2"},De={class:"space-y-2"},Re={key:0,class:"space-y-4 pt-4"},Me={class:"bg-gray-50 dark:bg-gray-800/50 rounded-xl p-4 space-y-3"},Te={class:"flex justify-between items-center"},Ie={class:"text-sm font-semibold"},je={class:"flex justify-between items-center"},Oe={class:"text-sm font-semibold text-red-600 dark:text-red-400"},Le={class:"flex justify-between items-center pt-2 border-t border-gray-200 dark:border-gray-700"},Xe={class:"text-lg font-bold text-green-600 dark:text-green-400"},Ke={class:"flex justify-between items-center pt-2 border-t border-gray-200 dark:border-gray-700"},Ue={class:"text-sm font-semibold"},ht={__name:"NewWithdrawal",props:{availableBalance:{type:Number,default:0},minWithdraw:{type:Number,default:10},fixedWithdrawFee:{type:Number,default:5},percentWithdrawFee:{type:Number,default:0},acquirerWithdrawalFee:{type:Number,default:.5}},setup(P){const b=P,{toast:k}=xe(),l=me({amount:0,pix_key_type:"CPF",pix_key:"",pix_key_description:""}),W=R(!1),C=R(!1),B=R(!1),w=R(null),F=M(()=>{let t=l.amount;if(t==null||t===""?t=0:typeof t=="string"?t=parseFloat(t.toString().replace(/[^\d,.-]/g,"").replace(",","."))||0:t=parseFloat(t)||0,t<=0||isNaN(t))return{fee:0,netAmount:0};const e=parseFloat(b.acquirerWithdrawalFee)||0,r=parseFloat((t*b.percentWithdrawFee/100).toFixed(2)),i=parseFloat(b.fixedWithdrawFee)||0,c=parseFloat((i+r).toFixed(2));let u;c>0&&c>=e?u=c:u=e;const p=parseFloat((t-u).toFixed(2));return{fee:Math.max(0,parseFloat(u.toFixed(2))),netAmount:Math.max(0,p)}}),f=t=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:2,maximumFractionDigits:2}).format(t),G=()=>{try{const t=l.pix_key_type,e=(l.pix_key||"").trim();if(!e||e==="")return!1;switch(t){case"CPF":return e.replace(/\D/g,"").length===11;case"CNPJ":return e.replace(/\D/g,"").length===14;case"EMAIL":const c=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,u=c.test(e)&&e.length>=5&&e.length<=255;return u||console.log("Email inválido:",e,"regex test:",c.test(e),"length:",e.length),u;case"PHONE":const p=e.replace(/\D/g,"");return p.length>=10&&p.length<=11;case"EVP":return/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(e);default:return!1}}catch(t){return console.error("Erro ao validar chave PIX:",t),!1}},Q=()=>{const t=parseFloat(l.amount)||0,e=parseFloat(b.minWithdraw)||10,r=F.value.netAmount||0,i=5;if(t>0&&t<e)return{valid:!1,message:`O valor mínimo para saque é de ${f(e)}. Após a taxa, você receberá ${f(r)} líquidos.`,minRequired:e};if(t>0&&r<i){const c=F.value.fee||0,u=i+c;return{valid:!1,message:`O valor líquido mínimo exigido é ${f(i)}. O valor mínimo para saque é de ${f(u)} (já incluindo as taxas).`,minRequired:u}}return{valid:!0}},Y=M(()=>{try{const t=l.amount,e=l.pix_key,r=l.pix_key_type;let i=t;if(i==null||i==="")i=0;else if(typeof i=="string"){const N=i.toString().replace(/[^\d,.-]/g,"").replace(",",".");i=parseFloat(N)||0}else i=parseFloat(i)||0;if(i<=0||isNaN(i))return console.log("Validação falhou: amount inválido",{amount:i,formAmount:t,type:typeof t}),!1;const c=parseFloat(b.minWithdraw)||0,u=parseFloat(b.availableBalance)||0,p=Math.round(i*100)/100,x=Math.round(u*100)/100;if(p>x)return console.log("Validação falhou: amount > availableBalance",{amount:i,amountRounded:p,availableBalance:u,availableBalanceRounded:x}),!1;const m=Math.round(c*100)/100;if(p<m)return console.log("Validação falhou: amount < minWithdraw",{amount:i,amountRounded:p,minWithdraw:c,minWithdrawRounded:m}),!1;const v=parseFloat((F.value.netAmount||0).toFixed(2)),S=Math.round(v*100)/100,j=5;if(S<j||isNaN(v)||S<=0)return console.log("Validação falhou: netAmount < minNetAmount",{netAmount:v,netAmountRounded:S,minNetAmount:j}),!1;const _=(e||"").trim();if(!_||_==="")return console.log("Validação falhou: pixKey vazio",{pixKey:_}),!1;const $=r;let V=!1;if($==="EMAIL")V=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(_)&&_.length>=5&&_.length<=255;else if($==="CPF")V=_.replace(/\D/g,"").length===11;else if($==="CNPJ")V=_.replace(/\D/g,"").length===14;else if($==="PHONE"){const N=_.replace(/\D/g,"");V=N.length>=10&&N.length<=11}else $==="EVP"&&(V=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(_));return V?!0:(console.log("Validação falhou: pixKey inválido",{type:$,pixKey:_,pixKeyValid:V}),!1)}catch(t){return console.error("Erro na validação do formulário:",t),!1}}),ee=M(()=>{let t=l.amount;if(t==null||t==="")return!1;if(typeof t=="string"){const i=t.toString().replace(/[^\d,.-]/g,"").replace(",",".");t=parseFloat(i)||0}else t=parseFloat(t)||0;if(t<=0||isNaN(t))return!1;const e=Math.round(t*100)/100,r=Math.round(b.availableBalance*100)/100;return e>r}),te=(t=new Date)=>{var u,p;const r=new Intl.DateTimeFormat("pt-BR",{timeZone:"America/Sao_Paulo",hour:"2-digit",minute:"2-digit",hour12:!1}).formatToParts(t),i=((u=r.find(x=>x.type==="hour"))==null?void 0:u.value.padStart(2,"0"))||"00",c=((p=r.find(x=>x.type==="minute"))==null?void 0:p.value.padStart(2,"0"))||"00";return`${i}:${c}`},ae=async()=>{var c,u,p;let t=l.amount;if(console.log("Valor original do formulário:",{amount:t,type:typeof t,formData:l.data()}),typeof t=="string"){const x=t.toString().replace(/[^\d,.-]/g,"").replace(",",".");t=parseFloat(x)}else t==null||t===""?t=0:t=parseFloat(t)||0;if(console.log("Valor convertido:",{amount:t,isNaN:isNaN(t)}),t<=0||isNaN(t)){console.error("Valor inválido detectado:",{original:l.amount,converted:t,formData:l.data()}),k({title:"Valor inválido",description:"Por favor, informe um valor válido para o saque. O valor informado foi: "+(l.amount||"vazio"),variant:"destructive"});return}const e=Math.round(t*100)/100,r=Math.round(b.availableBalance*100)/100;if(e>r){k({title:"Saldo insuficiente",description:`Você não possui saldo suficiente. Saldo disponível: ${f(b.availableBalance)}.`,variant:"destructive"});return}if(!l.pix_key||!G()){k({title:"Chave PIX inválida",description:"Verifique o tipo e o valor da chave PIX informada.",variant:"destructive"});return}const i=Q();if(!i.valid){k({title:"Valor líquido insuficiente",description:i.message,variant:"destructive"});return}C.value=!0;try{const x=(c=document.querySelector('meta[name="csrf-token"]'))==null?void 0:c.getAttribute("content");let m=l.amount;if(typeof m=="string"){const S=m.toString().replace(/[^\d,.-]/g,"").replace(",",".");m=parseFloat(S)}else m==null||m===""?m=0:m=parseFloat(m)||0;if(m<=0||isNaN(m)){k({title:"Valor inválido",description:"Por favor, informe um valor válido para o saque.",variant:"destructive"}),C.value=!1;return}const v=await ce.post(route("withdrawal.create"),{amount:m,pix_key_type:l.pix_key_type,pix_key:(l.pix_key||"").trim(),pix_key_description:l.pix_key_description||""},{headers:{"X-CSRF-TOKEN":x,"X-Requested-With":"XMLHttpRequest"}});v.data.status==="success"?(v.data.confirmed&&v.data.confirmed_message?(w.value={net_amount:v.data.net_amount,amount:v.data.amount,fee:v.data.fee,time:te()},B.value=!0,W.value=!1):(k({title:"Saque solicitado!",description:v.data.message||"Seu saque foi solicitado com sucesso e está sendo processado."}),W.value=!1),I(),pe.reload({only:["withdrawals","saldoDisponivel","extratoData"]})):(console.error("Resposta com status diferente de success:",v.data),k({title:"Erro ao solicitar saque",description:v.data.message||"Ocorreu um erro ao processar o saque.",variant:"destructive"}))}catch(x){console.error("Erro ao solicitar saque:",x);const m=((p=(u=x.response)==null?void 0:u.data)==null?void 0:p.message)||x.message||"Ocorreu um erro. Tente novamente.";k({title:"Erro ao solicitar saque",description:m,variant:"destructive"})}finally{C.value=!1}},I=()=>{l.reset(),l.pix_key_type="CPF",l.pix_key="",l.pix_key_description=""},oe=t=>({CPF:"000.000.000-00",CNPJ:"00.000.000/0000-00",EMAIL:"exemplo@email.com",PHONE:"(00) 00000-0000",EVP:"UUID da chave aleatória"})[t]||"Digite a chave PIX";return(t,e)=>(h(),q("div",null,[o(a(U),{open:W.value,"onUpdate:open":[e[5]||(e[5]=r=>W.value=r),e[6]||(e[6]=r=>{r||I()})]},{default:s(()=>[o(a(re),{"as-child":""},{default:s(()=>[fe(t.$slots,"trigger",{},()=>[o(a(D),{variant:"outline"},{default:s(()=>[o(a(ve),{class:"h-4 w-4"}),e[9]||(e[9]=n(" Solicitar Saque "))]),_:1})])]),_:3}),o(a(O),{class:"sm:max-w-lg"},{default:s(()=>[o(a(L),{class:"text-center"},{default:s(()=>[o(a(X),{class:"text-xl"},{default:s(()=>e[10]||(e[10]=[n("Nova Solicitação de Saque")])),_:1}),o(a(K),{class:"text-base"},{default:s(()=>e[11]||(e[11]=[n(" Transfira seu saldo para uma chave PIX ")])),_:1})]),_:1}),d("div",ge,[d("div",_e,[o(a(y),{class:"text-sm text-muted-foreground"},{default:s(()=>e[12]||(e[12]=[n("Saldo Disponível")])),_:1}),d("p",be,g(f(P.availableBalance)),1)]),d("div",ke,[o(a(y),{for:"amount"},{default:s(()=>e[13]||(e[13]=[n("Valor do Saque")])),_:1}),o(se,{modelValue:a(l).amount,"onUpdate:modelValue":e[0]||(e[0]=r=>a(l).amount=r),label:"",max:P.availableBalance},null,8,["modelValue","max"]),a(l).amount>0&&a(l).amount<P.minWithdraw?(h(),q("p",we,[o(a(T),{class:"h-3 w-3"}),n(" Valor mínimo: "+g(f(P.minWithdraw)),1)])):E("",!0),a(l).amount>0&&ee.value?(h(),q("p",he,[o(a(T),{class:"h-3 w-3"}),n(" Valor excede o saldo disponível. Saldo: "+g(f(P.availableBalance)),1)])):E("",!0),a(l).amount>0&&F.value.netAmount<5?(h(),q("p",Fe,[o(a(T),{class:"h-3 w-3"}),n(" Valor líquido mínimo: R$ 5,00 (valor necessário: "+g(f(5+F.value.fee))+") ",1)])):E("",!0)]),a(l).amount>0?(h(),q("div",Ve,[d("div",Ne,[o(a(y),{class:"text-sm text-muted-foreground"},{default:s(()=>e[14]||(e[14]=[n("Valor solicitado")])),_:1}),d("span",Pe,g(f(a(l).amount)),1)]),d("div",Ce,[o(a(y),{class:"text-sm text-red-600 dark:text-red-400"},{default:s(()=>e[15]||(e[15]=[n("Taxa")])),_:1}),d("span",$e," - "+g(f(F.value.fee)),1)]),d("div",qe,[o(a(y),{class:"text-sm font-semibold"},{default:s(()=>e[16]||(e[16]=[n("Você receberá")])),_:1}),d("span",Se,g(f(F.value.netAmount)),1)])])):E("",!0),d("div",Ae,[o(a(y),{class:"text-base font-semibold"},{default:s(()=>e[17]||(e[17]=[n("Chave PIX de Destino")])),_:1}),d("div",Ee,[d("div",We,[o(a(y),{for:"pix_key_type",class:"text-xs text-muted-foreground"},{default:s(()=>e[18]||(e[18]=[n("Tipo")])),_:1}),o(a(ne),{modelValue:a(l).pix_key_type,"onUpdate:modelValue":[e[1]||(e[1]=r=>a(l).pix_key_type=r),e[2]||(e[2]=r=>{a(l).pix_key_type=r})]},{default:s(()=>[o(a(ie),null,{default:s(()=>[o(a(de),{placeholder:"Tipo"})]),_:1}),o(a(ue),null,{default:s(()=>[o(a(A),{value:"CPF"},{default:s(()=>e[19]||(e[19]=[n("CPF")])),_:1}),o(a(A),{value:"CNPJ"},{default:s(()=>e[20]||(e[20]=[n("CNPJ")])),_:1}),o(a(A),{value:"EMAIL"},{default:s(()=>e[21]||(e[21]=[n("E-mail")])),_:1}),o(a(A),{value:"PHONE"},{default:s(()=>e[22]||(e[22]=[n("Telefone")])),_:1}),o(a(A),{value:"EVP"},{default:s(()=>e[23]||(e[23]=[n("Aleatória")])),_:1})]),_:1})]),_:1},8,["modelValue"])]),d("div",Be,[o(a(y),{for:"pix_key",class:"text-xs text-muted-foreground"},{default:s(()=>e[24]||(e[24]=[n("Chave PIX")])),_:1}),o(a(J),{id:"pix_key",modelValue:a(l).pix_key,"onUpdate:modelValue":e[3]||(e[3]=r=>a(l).pix_key=r),placeholder:oe(a(l).pix_key_type),class:"font-mono text-xs"},null,8,["modelValue","placeholder"])])]),d("div",De,[o(a(y),{for:"pix_key_description",class:"text-xs text-muted-foreground"},{default:s(()=>e[25]||(e[25]=[n("Descrição (Opcional)")])),_:1}),o(a(J),{id:"pix_key_description",modelValue:a(l).pix_key_description,"onUpdate:modelValue":e[4]||(e[4]=r=>a(l).pix_key_description=r),placeholder:"Ex: Nubank"},null,8,["modelValue"])])]),o(a(D),{onClick:ae,disabled:C.value||!Y.value,type:"submit",class:"w-full",size:"lg"},{default:s(()=>[C.value?(h(),z(a(ye),{key:1,class:"h-4 w-4 mr-2 animate-spin"})):(h(),z(a(Z),{key:0,class:"h-4 w-4 mr-2"})),e[26]||(e[26]=n(" Solicitar Saque "))]),_:1},8,["disabled"])]),o(a(H),{class:"sm:justify-start"},{default:s(()=>[o(a(le),{"as-child":""},{default:s(()=>[o(a(D),{disabled:C.value,type:"button",variant:"secondary"},{default:s(()=>e[27]||(e[27]=[n(" Cancelar ")])),_:1},8,["disabled"])]),_:1})]),_:1})]),_:1})]),_:3},8,["open"]),o(a(U),{open:B.value,"onUpdate:open":e[8]||(e[8]=r=>B.value=r)},{default:s(()=>[o(a(O),{class:"sm:max-w-md"},{default:s(()=>[o(a(L),{class:"text-center"},{default:s(()=>[o(a(X),{class:"text-xl flex items-center justify-center gap-2"},{default:s(()=>[o(a(Z),{class:"h-6 w-6 text-green-600 dark:text-green-400"}),e[28]||(e[28]=n(" Saque Confirmado! "))]),_:1}),o(a(K),{class:"text-base pt-2"},{default:s(()=>{var r;return[e[29]||(e[29]=n(" Seu saque de ")),d("strong",null,g(f(((r=w.value)==null?void 0:r.net_amount)||0)),1),e[30]||(e[30]=n(" foi processado com sucesso. ")),e[31]||(e[31]=d("br",null,null,-1)),e[32]||(e[32]=n(" O valor cairá instantaneamente ou em alguns minutos, dependendo da disponibilidade bancária. "))]}),_:1})]),_:1}),w.value?(h(),q("div",Re,[d("div",Me,[d("div",Te,[o(a(y),{class:"text-sm text-muted-foreground"},{default:s(()=>e[33]||(e[33]=[n("Valor solicitado")])),_:1}),d("span",Ie,g(f(w.value.amount)),1)]),d("div",je,[o(a(y),{class:"text-sm text-muted-foreground"},{default:s(()=>e[34]||(e[34]=[n("Taxa aplicada")])),_:1}),d("span",Oe," - "+g(f(w.value.fee)),1)]),d("div",Le,[o(a(y),{class:"text-sm font-semibold"},{default:s(()=>e[35]||(e[35]=[n("Valor líquido")])),_:1}),d("span",Xe,g(f(w.value.net_amount)),1)]),d("div",Ke,[o(a(y),{class:"text-sm text-muted-foreground"},{default:s(()=>e[36]||(e[36]=[n("Data/Hora")])),_:1}),d("span",Ue,g(w.value.time),1)])])])):E("",!0),o(a(H),null,{default:s(()=>[o(a(D),{onClick:e[7]||(e[7]=r=>{B.value=!1,w.value=null}),class:"w-full",size:"lg"},{default:s(()=>e[37]||(e[37]=[n(" Fechar ")])),_:1})]),_:1})]),_:1})]),_:1},8,["open"])]))}};export{ht as default};
