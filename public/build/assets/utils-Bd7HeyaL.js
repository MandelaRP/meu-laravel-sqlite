import{u as S}from"./useForwardExpose-BFkC9Kdc.js";import{P as _}from"./Primitive-odI4fKTA.js";import{h as T}from"./handleAndDispatchCustomEvent-ChOKVcqp.js";import{i as C,o as I}from"./index-BszNJtDQ.js";import{r as h,U as b,a0 as D,p as P,z as N,H as B,k as E,h as U,o as k,b as x,I as W,u as O,y as A}from"./app-S3kx2b0d.js";import{g}from"./Collection--76CoLyc.js";const R="dismissableLayer.pointerDownOutside",H="dismissableLayer.focusOutside";function F(e,t){const i=t.closest("[data-dismissable-layer]"),s=e.dataset.dismissableLayer===""?e:e.querySelector("[data-dismissable-layer]"),a=Array.from(e.ownerDocument.querySelectorAll("[data-dismissable-layer]"));return!!(i&&(s===i||a.indexOf(s)<a.indexOf(i)))}function M(e,t,i=!0){var d;const s=((d=t==null?void 0:t.value)==null?void 0:d.ownerDocument)??(globalThis==null?void 0:globalThis.document),a=h(!1),n=h(()=>{});return b(o=>{if(!C||!D(i))return;const u=async f=>{const m=f.target;if(!(!(t!=null&&t.value)||!m)){if(F(t.value,m)){a.value=!1;return}if(f.target&&!a.value){let y=function(){T(R,e,w)};const w={originalEvent:f};f.pointerType==="touch"?(s.removeEventListener("click",n.value),n.value=y,s.addEventListener("click",n.value,{once:!0})):y()}else s.removeEventListener("click",n.value);a.value=!1}},v=window.setTimeout(()=>{s.addEventListener("pointerdown",u)},0);o(()=>{window.clearTimeout(v),s.removeEventListener("pointerdown",u),s.removeEventListener("click",n.value)})}),{onPointerDownCapture:()=>{D(i)&&(a.value=!0)}}}function z(e,t,i=!0){var n;const s=((n=t==null?void 0:t.value)==null?void 0:n.ownerDocument)??(globalThis==null?void 0:globalThis.document),a=h(!1);return b(d=>{if(!C||!D(i))return;const o=async u=>{if(!(t!=null&&t.value))return;await P(),await P();const v=u.target;!t.value||!v||F(t.value,v)||u.target&&!a.value&&T(H,e,{originalEvent:u})};s.addEventListener("focusin",o),d(()=>s.removeEventListener("focusin",o))}),{onFocusCapture:()=>{D(i)&&(a.value=!0)},onBlurCapture:()=>{D(i)&&(a.value=!1)}}}const c=B({layersRoot:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set});var q=N({__name:"DismissableLayer",props:{disableOutsidePointerEvents:{type:Boolean,required:!1,default:!1},asChild:{type:Boolean,required:!1},as:{type:null,required:!1}},emits:["escapeKeyDown","pointerDownOutside","focusOutside","interactOutside","dismiss"],setup(e,{emit:t}){const i=e,s=t,{forwardRef:a,currentElement:n}=S(),d=E(()=>{var r;return((r=n.value)==null?void 0:r.ownerDocument)??globalThis.document}),o=E(()=>c.layersRoot),u=E(()=>n.value?Array.from(o.value).indexOf(n.value):-1),v=E(()=>c.layersWithOutsidePointerEventsDisabled.size>0),f=E(()=>{const r=Array.from(o.value),[p]=[...c.layersWithOutsidePointerEventsDisabled].slice(-1),l=r.indexOf(p);return u.value>=l}),m=M(async r=>{const p=[...c.branches].some(l=>l==null?void 0:l.contains(r.target));!f.value||p||(s("pointerDownOutside",r),s("interactOutside",r),await P(),r.defaultPrevented||s("dismiss"))},n),w=z(r=>{[...c.branches].some(l=>l==null?void 0:l.contains(r.target))||(s("focusOutside",r),s("interactOutside",r),r.defaultPrevented||s("dismiss"))},n);I("Escape",r=>{u.value===o.value.size-1&&(s("escapeKeyDown",r),r.defaultPrevented||s("dismiss"))});let y;return b(r=>{n.value&&(i.disableOutsidePointerEvents&&(c.layersWithOutsidePointerEventsDisabled.size===0&&(y=d.value.body.style.pointerEvents,d.value.body.style.pointerEvents="none"),c.layersWithOutsidePointerEventsDisabled.add(n.value)),o.value.add(n.value),r(()=>{i.disableOutsidePointerEvents&&c.layersWithOutsidePointerEventsDisabled.size===1&&(d.value.body.style.pointerEvents=y)}))}),b(r=>{r(()=>{n.value&&(o.value.delete(n.value),c.layersWithOutsidePointerEventsDisabled.delete(n.value))})}),(r,p)=>(k(),U(O(_),{ref:O(a),"as-child":r.asChild,as:r.as,"data-dismissable-layer":"",style:A({pointerEvents:v.value?f.value?"auto":"none":void 0}),onFocusCapture:O(w).onFocusCapture,onBlurCapture:O(w).onBlurCapture,onPointerdownCapture:O(m).onPointerDownCapture},{default:x(()=>[W(r.$slots,"default")]),_:3},8,["as-child","as","style","onFocusCapture","onBlurCapture","onPointerdownCapture"]))}}),ee=q;const te="focusScope.autoFocusOnMount",se="focusScope.autoFocusOnUnmount",ie={bubbles:!1,cancelable:!0};function re(e,{select:t=!1}={}){const i=g();for(const s of e)if(j(s,{select:t}),g()!==i)return!0}function ne(e){const t=K(e),i=L(t,e),s=L(t.reverse(),e);return[i,s]}function K(e){const t=[],i=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:s=>{const a=s.tagName==="INPUT"&&s.type==="hidden";return s.disabled||s.hidden||a?NodeFilter.FILTER_SKIP:s.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;i.nextNode();)t.push(i.currentNode);return t}function L(e,t){for(const i of e)if(!V(i,{upTo:t}))return i}function V(e,{upTo:t}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(t!==void 0&&e===t)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function $(e){return e instanceof HTMLInputElement&&"select"in e}function j(e,{select:t=!1}={}){if(e&&e.focus){const i=g();e.focus({preventScroll:!0}),e!==i&&$(e)&&t&&e.select()}}export{te as A,ee as D,ie as E,j as a,se as b,c,ne as d,re as f,K as g};
